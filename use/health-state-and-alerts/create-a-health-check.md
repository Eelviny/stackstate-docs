---
description: 
---

# Create a health check

- ??? do health checks always need to be manually added or is there a default added when a component/relation is created?
- ??? are health checks added with stackpacks?

## Overview

Health checks use check functions to report the status of components and relations in StackState. Any component/relation in a StackState topology view with a telemetry stream can have a health check assigned. The events generated by health checks can be used to [trigger alerts and actions](/use/health-state-and-alerts/add-an-alert.md).

## Assign a health check to a component or relation

You can assign a health check to a component or relation in the StackState Topology Perspective.

{% hint style="info" %}
Health checks require telemetry streams.
{% endhint %}

1. Select the component or relation that you want to assign a health check to.
    - If no telemetry stream is available on the selected component/relation, you will need to [add a telemetry stream](/use/health-state-and-alerts/add-telemetry-to-component.md).
3. Click **+ ADD** next to **Health** on the right of the screen. 
    - An **Add check** dialog box appears.
4. Provide the following details:
    - **Name** - ???
    - **Description** - Optional, can be used to explain the check in greater detail.
    - **Remediation hint** - Optional, will be automatically displayed on the component or relation when this check goes to a non clear state, for example `critical` or `deviating`.
    - **Check function** - The check function to use to monitor the component/relation's telemetry stream(s). See [Check functions](#check-functions) below.
5. Provide the required check function arguments, these will vary according to the check function selected, but will include:
    - At least one telemetry stream. Some checks will require multiple streams. 
    - For metrics check functions: A windowing method and window size, see [Windowing for metrics check functions](#windowing-for-metrics-check-functions) below.
9. Click **CREATE** to create the health check. 
    - The check is now active and visible under the **Health** section on the right side of the screen. 
    - At first, the check will appear gray. This is because its health state is not yet known. As soon as enough telemetry has been received ,the check will get a health state.


## Check functions

Each health check uses a check function to monitor the telemetry stream attached to the component/relation. 

Check functions are scripts that take streaming telemetry as an input, check the data based on its logic and on the supplied arguments and output a health state. The telemetry changes a check function responds to determine the way in which the health check reports component/relation health state, for example by monitoring a metric stream for thresholds and spikes, or checking the generated events. 
A number of check functions are included out of the box with StackState, or you could create your own.

### Baseline anomaly detection
Officially a baseline function, see [baseline anomaly detection](/use/health-state-and-alerts/baselining.md).

### Event contains key/value*
Check that the last event contains (at the top-level), the specified value for a key.
Returns: `HEALTH_STATE` - `trueState` when the key/value is present, `falseState` when it is not.

### Event fixed state
This check will always return the state that is provided when an event has been received.
Returns: `HEALTH_STATE`

### Event fixed run state
This check will always return the run state that is provided when an event has been received.
Returns: `RUN_STATE`

### Metrics failed ratio
Calculate the ratio between the last values of two streams (one is the normal metric stream and one is the failed metric stream). This ratio is compared against the deviating or critical value.
Returns: `HEALTH_STATE`

### Metric fixed state
This check will always return the health state that is provided when a metric has been received.
Returns: `HEALTH_STATE`

### Metric fixed run state
This check will always return the run state that is provided when a metric has been received.
Returns: `RUN_STATE`

### Metrics last/max threshold
Checks whether the ratio of the last value and its maximum is above the critical or deviating percentage.
Returns: `HEALTH_STATE`

### Metrics local anomaly detection
Check to detect spikes by calculating a standard deviation on the points in the time window and report deviating when a number of values exceed the multiple.
Returns: `HEALTH_STATE`

### Metrics maximum average
Calculate the health state by comparing the average of all metric points in the time window against the configured maximum values.
Returns: `HEALTH_STATE`

## Windowing method

For metrics check functions, a windowing method and window size must be provided. This determines how often the check function will run based on the incoming metrics. 

- **Batching** - With windowing method batching and a window size of 60 seconds, the check will run every minute with a minute of metrics.
- **Sliding** - If the windowing method is set to sliding and window size is set to 60 seconds, the check runs whenever the data flows in after 60 seconds of metrics have been collected.

